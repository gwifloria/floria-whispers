 紧急优化项

  1. 构建产物过大 (1.3GB)

  - 问题: .next 目录占用 1.3GB，可能包含大量未优化资源
  - 建议:
  # 分析打包体积
  ANALYZE=true yarn build

  # 检查是否需要清理缓存
  yarn clean
  - 优化方向:
    - 启用 Tree Shaking 和 Code Splitting
    - 检查是否有不必要的依赖被打包
    - 考虑使用动态导入 next/dynamic 延迟加载重组件（Three.js, TipTap 等）

  2. React Strict Mode 已关闭

  - 当前: reactStrictMode: false (next.config.mjs:56)
  - 风险: 可能隐藏潜在问题，不利于升级到 React 19
  - 建议: 逐步启用并修复警告

  3. 依赖过重

  重量级依赖需要优化加载：
  - three + @react-three/fiber - 3D 渲染库
  - @ant-design/plots - 图表库
  - @tiptap/* - 富文本编辑器
  - mapbox-gl - 地图库

  建议:
  // 使用动态导入
  const Scene3D = dynamic(() => import('@/components/Scene3D'), {
    ssr: false,
    loading: () => <LoadingSpinner />
  })

  const TipTapEditor = dynamic(() => import('@/components/Editor'), {
    ssr: false
  })

  🔧 架构优化

  4. Monorepo 结构未完成

  - 当前状态: README 描述了 apps/web, apps/api,
  packages/*，但实际只有单体应用
  - 建议:
    - 如果不需要 monorepo，移除 Turborepo 配置简化项目
    - 如果需要，完成迁移到 workspace 结构
    - 参考 MIGRATION.md 完成迁移

  5. Vercel 构建配置可优化

  // vercel.json - 当前使用 yarn workspaces foreach
  {
    "buildCommand": "yarn workspaces foreach -Apt --include
  '@wonderland/{database,shared}' run build && yarn build:web"
  }
  - 问题: 如果实际没有 workspace，这个命令可能有问题
  - 建议: 根据实际结构调整构建命令

  ⚡ 性能优化

  6. 图片优化

  - 优点: 已配置 AVIF + WebP (next.config.mjs:71)
  - 建议:
    - 检查 public/ 目录图片是否都已优化
    - 运行 yarn img:opt 优化图片
    - 考虑使用 Cloudinary 的自动优化功能

  7. API 路由性能

  # 检查 API 路由数量
  find src/app/api -name "route.ts" | wc -l
  - 建议:
    - 为频繁访问的 API 添加缓存策略
    - 使用 Next.js 15 的 unstable_cache 或 Redis
    - 考虑为 /api/posts/list 等列表接口添加分页和缓存

  8. 数据库连接优化

  - 检查点: MongoDB 连接池配置
  - 建议: 查看 @wonderland/database 包的连接管理，确保使用连接池

  🛡️ 代码质量

  9. TypeScript 严格模式

  // tsconfig.json - 检查是否启用严格模式
  {
    "compilerOptions": {
      "strict": true,
      "noUncheckedIndexedAccess": true
    }
  }

  10. 测试覆盖率

  - 当前: 配置了 Jest + Playwright
  - 建议:
    - 为核心功能添加单元测试
    - 为关键用户流程添加 E2E 测试
    - 设置测试覆盖率目标

  🔒 安全性

  11. 环境变量验证

  - 优点: 已在 next.config.mjs 中验证必需的环境变量
  - 建议:
    - 为生产环境添加更多验证
    - 使用 zod 或类似库验证环境变量格式

  12. Admin 路由保护

  - 检查: /admin/monitoring 需要确保有身份验证
  - 建议: 使用 NextAuth middleware 保护敏感路由

  📊 监控优化

  13. Sentry 配置

  - 当前: 已配置 Sentry
  - 建议:
    - 检查 source maps 上传
    - 设置合理的采样率
    - 配置 Performance Monitoring

  14. Web Vitals

  - 已有: 性能监控面板
  - 建议:
    - 设置性能预算和告警
    - 定期查看性能报告
    - 优化 LCP, FID, CLS 指标

  🧹 清理建议

  15. 依赖清理

  # 检查未使用的依赖
  npx depcheck

  # 检查过时的依赖
  yarn outdated

  16. 代码清理

  - 移除未使用的组件和样式
  - 统一样式方案（当前混用 Tailwind + SCSS + Ant Design）
  - 清理 console.log（已有 clean:console 脚本）


