---
status: idea
type: å·¥åŠ
language: å¾…å®š
created: {{date:YYYY-MM-DD}}
updated: {{date:YYYY-MM-DD}}
tags:
  - 
---


## ç—›ç‚¹

åœ¨ç ”ç©¶ Claude Code çš„æœ€ä½³å®è·µä¸­ï¼ŒçŸ¥é“ Git Worktree å’Œ Claude çš„æ­é…å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šæ¿€å‘ Claude çš„æœ€å¤§æ½œèƒ½ã€‚ä½†æˆ‘ä¹‹å‰ç”¨å¾—ä¸å¤šï¼Œä»”ç»†å‰–æè‡ªå·±ä¸æ„¿æ„ç”¨çš„åŸå› ï¼Œå‘ç°ä¸»è¦æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼š

**1. å‘½ä»¤å¤ªé•¿äº†**

```bash
git worktree add ../wonderland-nexus-feature-a -b feature-a
```

æ¯æ¬¡éƒ½è¦å®Œæ•´æ•²å‡ºé¡¹ç›®åã€è·¯å¾„ã€åˆ†æ”¯åï¼Œé‡å¤ä¸”å®¹æ˜“æ‰“é”™ã€‚

**2. .env.local ä¸ä¼šè‡ªåŠ¨åŒæ­¥**

è¿™æ˜¯ Git Worktree çš„ç‰¹æ€§å†³å®šçš„â€”â€”æ¯ä¸ª worktree æ˜¯ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œè€Œ `.env.local` è¢« `.gitignore` å¿½ç•¥ï¼Œè‡ªç„¶ä¸ä¼šè¢« git åŒæ­¥è¿‡å»ã€‚

é—®é¢˜æ˜¯æˆ‘çš„é¡¹ç›®å¯åŠ¨ä¾èµ–è¿™äº›æœ¬åœ°ç¯å¢ƒå˜é‡é…ç½®ã€‚æ¯æ¬¡æ–°å»ºä¸€ä¸ª worktreeï¼Œä¸‹æ¬¡éƒ½è¦å†æ‰‹åŠ¨æŠŠè¿™æ–‡ä»¶å¤åˆ¶ä¸€éï¼ŒçœŸçš„æœ‰ç‚¹éº»çƒ¦ï¼ˆAI æœç„¶è®©äººè¶Šæ¥è¶Šæ‡’ï¼‰ã€‚

ä½†å› ä¸ºè¿™ç‚¹å°éº»çƒ¦å°±æ”¾å¼ƒä½¿ç”¨ worktree è¿™ä¸ªå¥½å·¥å…·ï¼Œæ„Ÿè§‰åƒæ˜¯æ¡äº†èŠéº»ä¸¢äº†è¥¿ç“œã€‚

æ‰€ä»¥æˆ‘è§‰å¾—è¿™ä¹Ÿå¯ä»¥è‡ªåŠ¨åŒ–ã€‚æˆ‘è‡ªå·±è¿‡å»åœ¨ shell é‡Œæ•² git å‘½ä»¤æ—¶ï¼Œå·²ç»é…ç½®è¿‡ `gp`ï¼ˆgit pushï¼‰`gl`ï¼ˆgit pullï¼‰è¿™ç±» aliasï¼Œæ·±çŸ¥å°‘æ•²å‡ ä¸ªå­—ç¬¦æœ‰å¤šä¹ˆçˆ½ã€‚

å¹²è„†è®© Claude å¸®æˆ‘å†™äº†ä¸ªè‡ªåŠ¨åŒ–æ–¹æ¡ˆï¼Œåœ¨åšçš„è¿‡ç¨‹ä¸­ä¹Ÿå‘ç°äº†å¯ä»¥ä¸€æ­¥æ­¥è¿­ä»£ä¼˜åŒ–çš„ç‚¹ã€‚

---

## V1ï¼šè‡ªåŠ¨åŒæ­¥ .env.local

ç¬¬ä¸€ç‰ˆçš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼šç”¨ä¸€ä¸ª shell è„šæœ¬å¤„ç†åŒæ­¥é€»è¾‘ï¼Œå†é€šè¿‡ git alias æŠŠå®ƒå’Œ `git worktree add` ä¸²èµ·æ¥ã€‚

**åŒæ­¥è„šæœ¬** (`scripts/sync-env-to-worktree.sh`)ï¼š

- è‡ªåŠ¨æ£€æµ‹ä¸» worktree çš„ä½ç½®
- éå†æ‰€æœ‰éœ€è¦åŒæ­¥çš„ `.env.local` æ–‡ä»¶
- å¤åˆ¶åˆ°ç›®æ ‡ worktree å¯¹åº”çš„ä½ç½®

**Git Alias** (`.git/config`)ï¼š

```ini
[alias]
    wt = "!f() { \
        git worktree add \"$@\" && \
        WORKTREE_PATH=$(echo \"$@\" | awk '{print $1}') && \
        ./scripts/sync-env-to-worktree.sh \"$WORKTREE_PATH\"; \
    }; f"
```

å½“æ‰§è¡Œ `git wt` æ—¶ï¼Œä¼šå…ˆåˆ›å»º worktreeï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨åŒæ­¥è„šæœ¬ã€‚

ä½¿ç”¨æ–¹å¼ï¼š

```bash
git wt ../wonderland-nexus-feature feature-branch
# åˆ›å»º worktree åè‡ªåŠ¨è§¦å‘åŒæ­¥è„šæœ¬
```

å¦å¤–åœ¨ `package.json` é‡Œä¹ŸåŠ äº†ä¸ª npm script ä½œä¸ºå¤‡ç”¨ï¼š

```json
{
  "scripts": {
    "sync-env": "bash scripts/sync-env-to-worktree.sh"
  }
}
```

è¿™æ ·å¦‚æœå¿˜äº†ç”¨ `git wt`ï¼Œæˆ–è€…ä¸» worktree çš„ `.env.local` æ›´æ–°äº†ï¼Œè¿˜å¯ä»¥æ‰‹åŠ¨åŒæ­¥ï¼š

```bash
yarn sync-env ../wonderland-nexus-feat-like
```

è¿™æ ·å°±ä¸ç”¨æ¯æ¬¡æ‰‹åŠ¨å¤åˆ¶äº†ã€‚ä½†å‘½ä»¤æœ¬èº«è¿˜æ˜¯å¾ˆé•¿ï¼Œç”¨èµ·æ¥è¿˜æ˜¯ä¸å¤Ÿçˆ½ã€‚

---

## V2ï¼šç®€åŒ–å‘½ä»¤è¾“å…¥

ä»”ç»†è§‚å¯Ÿäº†ä¸€ä¸‹æˆ‘çš„ä½¿ç”¨ä¹ æƒ¯ï¼šworktree çš„è·¯å¾„é€šå¸¸æ˜¯ `../é¡¹ç›®å-åˆ†æ”¯å`ï¼Œè€Œåˆ†æ”¯ååœ¨å‘½ä»¤é‡Œè¦æ•²ä¸¤éï¼ˆè·¯å¾„é‡Œä¸€æ¬¡ï¼Œ`-b` åé¢ä¸€æ¬¡ï¼‰ï¼Œé‚£æˆ‘è§‰å¾—è¿™ä¹Ÿå¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼Œå°±æŠŠæˆ‘çš„éœ€æ±‚å–‚ç»™äº† Claude Codeã€‚

æ›´æ–°åçš„ Git Aliasï¼š

```ini
[alias]
    wt = "!f() { \
        if [ $# -eq 1 ]; then \
            BRANCH=\"$1\"; \
            WORKTREE_PATH=\"../wonderland-nexus-$BRANCH\"; \
            git worktree add \"$WORKTREE_PATH\" -b \"$BRANCH\"; \
        else \
            git worktree add \"$@\"; \
            WORKTREE_PATH=\"$1\"; \
        fi && \
        ./scripts/sync-env-to-worktree.sh \"$WORKTREE_PATH\"; \
    }; f"
```

é€»è¾‘å¾ˆç®€å•ï¼šæ£€æµ‹å‚æ•°æ•°é‡ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°å°±èµ°ç®€åŒ–æ¨¡å¼ï¼Œè‡ªåŠ¨æ¨æ–­è·¯å¾„å’Œåˆ†æ”¯åï¼›å¤šä¸ªå‚æ•°å°±èµ°å®Œæ•´æ¨¡å¼ï¼Œé€ä¼ ç»™åŸç”Ÿå‘½ä»¤ã€‚

ä¼˜åŒ–ååªéœ€è¦è¾“å…¥åˆ†æ”¯åï¼š

```bash
git wt feat-xxx
# è‡ªåŠ¨æ¨æ–­è·¯å¾„ï¼š../wonderland-nexus-feat-xxx
# è‡ªåŠ¨åˆ›å»ºåˆ†æ”¯ï¼š-b feat-xxx
# è‡ªåŠ¨åŒæ­¥ .env.local
```

è¾“å…¥é‡ä¸€ä¸‹å­å‡å°‘äº† 70%ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå®Œæ•´æ¨¡å¼è¿˜æ˜¯ä¿ç•™ç€çš„ï¼š

```bash
git wt ~/custom-path -b custom-branch  # å®Œå…¨å…¼å®¹åŸæ¥çš„ç”¨æ³•
```

åˆ°è¿™é‡Œå·²ç»å¾ˆå¥½ç”¨äº†ï¼Œä½†æˆ‘åˆå‘ç°äº†ä¸€ä¸ªå¯ä»¥ä¼˜åŒ–çš„ç‚¹ã€‚

---

## V3ï¼šæ”¯æŒåˆ†æ”¯åç”¨ `/` åˆ†éš”

æˆ‘å¶å°”ä¼šç”¨ Git çš„ GUI å·¥å…·ï¼ˆæ¯”å¦‚ SourceTreeï¼‰ï¼Œå‘ç°ä¸€ä¸ªç»†èŠ‚ï¼šå¦‚æœåˆ†æ”¯åç”¨ `/` åˆ†éš”ï¼ˆæ¯”å¦‚ `feat/xxx`ï¼‰ï¼Œåœ¨ GUI é‡Œä¼šè‡ªåŠ¨åˆ†ç»„æ˜¾ç¤ºæˆæ–‡ä»¶å¤¹ç»“æ„ï¼š

```
ğŸ“ feat
  â”œâ”€ like-button
  â””â”€ share-feature
ğŸ“ fix
  â””â”€ navbar-bug
```

è¿™æ ·çœ‹èµ·æ¥å¾ˆæ¸…æ™°ï¼ŒåŒç±»å‹çš„åˆ†æ”¯ä¼šè¢«å½’åˆ°ä¸€èµ·ã€‚è¿™ä¹Ÿæ˜¯ Git Flow æ¨èçš„å‘½åæ–¹å¼ã€‚

ä½†æˆ‘ä¹Ÿéœ€è¦ä¿ç•™æ–‡ä»¶å¤¹çš„å‘½åæ–¹å¼ã€‚

**æœ€ç»ˆæ–¹æ¡ˆ**ï¼šè®© Git åˆ†æ”¯åä¿ç•™ `/`ï¼Œè€Œ worktree çš„æ–‡ä»¶å¤¹è·¯å¾„è‡ªåŠ¨æŠŠ `/` è½¬æ¢æˆ `-`ï¼š

```ini
[alias]
    wt = "!f() { \
        if [ $# -eq 1 ]; then \
            BRANCH=\"$1\"; \
            WORKTREE_NAME=$(echo \"$BRANCH\" | tr '/' '-'); \
            WORKTREE_PATH=\"../wonderland-nexus-$WORKTREE_NAME\"; \
            git worktree add \"$WORKTREE_PATH\" -b \"$BRANCH\"; \
        else \
            git worktree add \"$@\"; \
            WORKTREE_PATH=\"$1\"; \
        fi && \
        ./scripts/sync-env-to-worktree.sh \"$WORKTREE_PATH\"; \
    }; f"
```

å…³é”®æ”¹åŠ¨æ˜¯åŠ äº†è¿™è¡Œï¼š

```bash
WORKTREE_NAME=$(echo \"$BRANCH\" | tr '/' '-')
```

ç”¨ `tr` å‘½ä»¤æŠŠåˆ†æ”¯åé‡Œçš„ `/` è½¬æ¢æˆ `-`ã€‚

```bash
git wt feat/like-button
# Git åˆ†æ”¯åï¼šfeat/like-buttonï¼ˆGUI ä¸­ä¼šåˆ†ç»„æ˜¾ç¤ºï¼‰
# Worktree è·¯å¾„ï¼š../wonderland-nexus-feat-like-buttonï¼ˆæ–‡ä»¶ç³»ç»Ÿå‹å¥½ï¼‰
```

---

## æœ€ç»ˆçš„ä½¿ç”¨æ–¹å¼

```bash
# æ—¥å¸¸ä½¿ç”¨ï¼ˆä¸€ä¸ªå‚æ•°æå®šä¸€åˆ‡ï¼‰
git wt feat/new-feature

# ç‰¹æ®Šéœ€æ±‚ï¼ˆå®Œæ•´æ¨¡å¼ä»ç„¶å¯ç”¨ï¼‰
git wt ~/custom-path -b branch

# è¡¥æ•‘æªæ–½ï¼ˆå¿˜äº†ç”¨ git wt æˆ–è€…ä¸» worktree æ›´æ–°äº†é…ç½®ï¼‰
yarn sync-env ../some-worktree
```
 
## v4 
 æˆ‘ä»¬ç°åœ¨ä¼šå€ŸåŠ© git worktree åŒæ—¶è®© claude è¿›è¡Œä¸åŒä»»åŠ¡çš„å¼€å‘ï¼Œä¹Ÿæ„å‘³ç€
æˆ‘åœ¨æ£€æŸ¥æ—¶å¯èƒ½ä¼šèµ·å¤šä¸ªæœåŠ¡ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘å¹¶ä¸ç¡®å®šå“ªä¸ªæœåŠ¡å¯¹åº”çš„æ˜¯å“ªä¸€ä¸ª
featï¼Œæ˜¯å¦å¯ä»¥æ ¹æ®å½“å‰ï¼ˆæ–‡ä»¶å¤¹å/åˆ†æ”¯åï¼‰ï¼Œåœ¨ç¼–è¯‘æ—¶æ³¨å…¥å‰ç«¯å±•ç¤ºï¼Œè®©æˆ‘æ¸…æ™°
çš„å¯ä»¥çŸ¥é“åœ¨å¯¹åº”åˆ†æ”¯æ—¶å¯ä»¥focus 

ä½¿ç”¨ git worktree åŒæ—¶å¼€å‘å¤šä¸ªåŠŸèƒ½æ—¶ï¼Œéœ€è¦åœ¨å‰ç«¯é¡µé¢æ˜¾ç¤ºå½“å‰åˆ†æ”¯åï¼Œæ–¹ä¾¿åŒº
 åˆ†ä¸åŒæœåŠ¡å¯¹åº”çš„åŠŸèƒ½ã€‚

 å®ç°æ–¹æ¡ˆ

 1. åœ¨æ„å»ºæ—¶æ³¨å…¥åˆ†æ”¯ååˆ°ç¯å¢ƒå˜é‡

 ä¿®æ”¹æ–‡ä»¶: apps/web/next.config.mjs

 åœ¨ env é…ç½®ä¸­æ·»åŠ ï¼š
 env: {
   // ç°æœ‰é…ç½®...
   NEXT_PUBLIC_GIT_BRANCH: (() => {
     try {
       return require('child_process')
         .execSync('git rev-parse --abbrev-ref HEAD')
         .toString().trim();
     } catch {
       return 'unknown';
     }
   })(),
 },

 2. åˆ›å»ºå¼€å‘ç¯å¢ƒæŒ‡ç¤ºå™¨ç»„ä»¶

 æ–°å»ºæ–‡ä»¶: apps/web/src/components/DevBranchIndicator.tsx

 åŠŸèƒ½ï¼š
 - ä»…åœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤º (NODE_ENV === 'development')
 - å›ºå®šåœ¨é¡µé¢å³ä¸‹è§’
 - æ˜¾ç¤ºå½“å‰åˆ†æ”¯å
 - å¯æŠ˜å /å±•å¼€
 - åŠé€æ˜æ‚¬æµ®æ ·å¼

 3. åœ¨æ ¹å¸ƒå±€ä¸­å¼•å…¥ç»„ä»¶

 ä¿®æ”¹æ–‡ä»¶: apps/web/src/app/layout.tsx

 åœ¨ body æœ«å°¾æ·»åŠ  <DevBranchIndicator /> ç»„ä»¶ã€‚

 æ˜¾ç¤ºå†…å®¹

 æŒ‡ç¤ºå™¨å°†æ˜¾ç¤ºï¼š
 - åˆ†æ”¯åï¼ˆå¦‚ feat/dark-modeï¼‰
 - å¯é€‰ï¼šç«¯å£å·ã€æ„å»ºæ—¶é—´

 æ ·å¼è®¾è®¡

 - ä½ç½®ï¼šå³ä¸‹è§’å›ºå®š
 - èƒŒæ™¯ï¼šåŠé€æ˜é»‘è‰²
 - æ–‡å­—ï¼šç™½è‰²å°å­—
 - å¯ç‚¹å‡»æŠ˜å 
 - ä¸å½±å“æ­£å¸¸é¡µé¢æ“ä½œ

 ç¯å¢ƒé™åˆ¶

 ä»…åœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤º (NODE_ENV === 'development')ï¼Œç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸æ¸²æŸ“ã€‚
![[Pasted image 20251201082332.png]]

![[Pasted image 20251201082256.png]]
