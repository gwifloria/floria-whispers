

  有的，我做了一个 Git 提交时自动优化图片的钩子。

  背景是这样的：我们项目是一个内容型网站，图片比较多。之前经常出现一个问题——
  开发同学写完功能直接提交，忘记压缩图片，一张 3MB
  的原图就进仓库了。等发现的时候要么回滚，要么再补一个 commit，挺麻烦的。

  我的思路是：与其靠人记住，不如让流程自动化。就像我们用 ESLint
  检查代码风格一样，图片优化也应该是提交流程的一部分。

  具体实现：我用 Husky 配置了一个 pre-commit 钩子，检测暂存区里有没有新增的
  jpg/png 文件。如果有，就调用 Sharp 库自动生成 AVIF 和 WebP
  两种格式，然后把生成的文件一起加入这次提交。

  为什么选择 pre-commit 而不是放在 CI
  里做？主要是考虑到图片优化后需要写回仓库。如果在 CI
  阶段处理，还要解决"优化完的文件怎么合回来"的问题，流程会复杂很多。本地
  pre-commit 就很直接，提交的时候就地处理完了。

  效果：上线之后基本没再出现过提交原图的情况。而且因为统一生成了现代格式，配
  合前端组件的 picture 标签，页面图片体积平均减少了 60% 左右。