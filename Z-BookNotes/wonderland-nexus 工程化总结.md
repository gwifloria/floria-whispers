     wonderland-nexus å·¥ç¨‹åŒ–æ€»ç»“

  ä¸€ã€å·¥ä½œæµæ¦‚è§ˆ

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                         å¼€å‘ & æäº¤æµç¨‹                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  ç¼–å†™ä»£ç  â†’ git add â†’ pre-commit hooks è‡ªåŠ¨æ‰§è¡Œ:                      â”‚
  â”‚           â”‚                                                         â”‚
  â”‚           â”œâ”€ 1. lint-staged (Prettier + ESLint)                     â”‚
  â”‚           â”œâ”€ 2. TypeScript ç±»å‹æ£€æŸ¥                                  â”‚
  â”‚           â””â”€ 3. commitlint æ ¡éªŒæäº¤ä¿¡æ¯æ ¼å¼                           â”‚
  â”‚                                                                     â”‚
  â”‚  PR åˆå¹¶åˆ° main â†’ GitHub Actions è‡ªåŠ¨:                               â”‚
  â”‚           â”‚                                                         â”‚
  â”‚           â”œâ”€ 1. è§£æ Conventional Commits                           â”‚
  â”‚           â”œâ”€ 2. è‡ªåŠ¨è®¡ç®—è¯­ä¹‰åŒ–ç‰ˆæœ¬å·                                  â”‚
  â”‚           â”œâ”€ 3. ç”Ÿæˆ Changelog å¹¶åˆ›å»º Release                        â”‚
  â”‚           â””â”€ 4. è§¦å‘ Vercel/Render éƒ¨ç½²                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ---
  äºŒã€å·¥ç¨‹åŒ–äº®ç‚¹ & é¢è¯•å…«è‚¡å¯¹ç…§

  1. Turborepo Monorepo æ¶æ„

  é…ç½®ä½ç½®: turbo.json

  {
    "tasks": {
      "build": {
        "dependsOn": [],
        "outputs": [".next/**", "dist/**"]
      }
    }
  }

  è§£å†³çš„ç—›ç‚¹:
  | ç—›ç‚¹        | è§£å†³æ–¹æ¡ˆ                     |
  |-----------|--------------------------|
  | å¤šåŒ…é¡¹ç›®æ„å»ºæ…¢   | Turbo çš„å¢é‡æ„å»ºå’Œè¿œç¨‹ç¼“å­˜ï¼Œåªé‡å»ºå˜æ›´çš„åŒ… |
  | ä¾èµ–é¡ºåºæ··ä¹±    | dependsOn è‡ªåŠ¨å¤„ç†ä¾èµ–æ‹“æ‰‘æ’åº     |
  | CI/CD æ—¶é—´é•¿ | åˆ©ç”¨æ„å»ºç¼“å­˜ï¼Œç¬¬äºŒæ¬¡æ„å»ºå‡ ä¹ç§’å®Œæˆ        |

  é¢è¯•è€ƒç‚¹:
  - ä¸ºä»€ä¹ˆä¸ç”¨ Lerna? Turbo åŸç”Ÿæ”¯æŒå¢é‡æ„å»ºå’Œä»»åŠ¡å¹¶è¡Œï¼Œæ€§èƒ½æ›´å¥½
  - workspace: åè®®*: ç¡®ä¿åŒ…é—´å¼•ç”¨å§‹ç»ˆä½¿ç”¨æœ€æ–°æœ¬åœ°ä»£ç ï¼Œé¿å…ç‰ˆæœ¬ä¸ä¸€è‡´

  ---
  2. Git Hooks è‡ªåŠ¨åŒ– (Husky + lint-staged)

  é…ç½®ä½ç½®: .husky/pre-commit

  yarn lint-staged || exit 1
  yarn typecheck

  è§£å†³çš„ç—›ç‚¹:
  | ç—›ç‚¹                 | è§£å†³æ–¹æ¡ˆ                                  |
  |--------------------|---------------------------------------|
  | æäº¤ä»£ç é£æ ¼ä¸ä¸€è‡´          | lint-staged è‡ªåŠ¨æ ¼å¼åŒ–æš‚å­˜æ–‡ä»¶                 |
  | ç±»å‹é”™è¯¯è¢«æäº¤            | pre-commit å¼ºåˆ¶æ‰§è¡Œ tsc --noEmit          |
  | commit message ä¸è§„èŒƒ | commitlint å¼ºåˆ¶ Conventional Commits æ ¼å¼ |

  é¢è¯•è€ƒç‚¹:
  - ä¸ºä»€ä¹ˆåªæ£€æŸ¥ staged æ–‡ä»¶? é¿å…å…¨é‡æ£€æŸ¥è€—æ—¶ï¼Œä¸”ä¸å½±å“å…¶ä»–äººæœªæäº¤çš„ä»£ç 
  - husky åŸç†: åˆ©ç”¨ Git çš„ hooks æœºåˆ¶ (.git/hooks/)ï¼Œåœ¨ç‰¹å®šç”Ÿå‘½å‘¨æœŸæ‰§è¡Œè„šæœ¬

  ---
  3. å›¾ç‰‡è‡ªåŠ¨ä¼˜åŒ–æµç¨‹

  é…ç½®ä½ç½®: apps/web/scripts/optimize-images.mjs

  // è‡ªåŠ¨ç”Ÿæˆ AVIF (è´¨é‡ 40) å’Œ WebP (è´¨é‡ 60)
  await sharp(file)
    .avif({ quality: 40, effort: 6 })
    .toFile(`${base}.avif`);

  Next.js é…ç½®:
  images: {
    formats: ["image/avif", "image/webp"],  // AVIF ä¼˜å…ˆ
  }

  è§£å†³çš„ç—›ç‚¹:
  | ç—›ç‚¹        | è§£å†³æ–¹æ¡ˆ                              |
  |-----------|-----------------------------------|
  | å›¾ç‰‡ä½“ç§¯å¤§ï¼ŒåŠ è½½æ…¢ | AVIF æ¯” WebP å†å° 20-50%             |
  | æ‰‹åŠ¨å‹ç¼©ç¹ç    | yarn img:opt ä¸€é”®æ‰¹é‡å¤„ç†               |
  | æµè§ˆå™¨å…¼å®¹æ€§    | Next.js è‡ªåŠ¨æ ¹æ® Accept header è¿”å›æœ€ä¼˜æ ¼å¼ |
  | ç¼“å­˜å¤±æ•ˆ      | Cache-Control: immutable é•¿æœŸç¼“å­˜     |

  é¢è¯•è€ƒç‚¹:
  - ä¸ºä»€ä¹ˆ AVIF > WebP > PNG? å‹ç¼©ç‡: AVIF (æ¯” JPEG å° 50%) > WebP (æ¯” JPEG å° 30%)
  - effort: 6 çš„å«ä¹‰: å‹ç¼©ç­‰çº§ï¼Œè¶Šé«˜å‹ç¼©ç‡è¶Šå¥½ä½†ç¼–ç è¶Šæ…¢

  ---
  4. GitHub OAuth ç®€åŒ–é‰´æƒ

  é…ç½®ä½ç½®: apps/web/src/constants/auth.ts

  export const ADMIN_EMAIL = "ghuijue@gmail.com";
  export const CONTENT_POOL_WHITELIST = ["ghuijue@gmail.com", ...];

  export function isAdminUser(email?: string | null): boolean {
    return email === ADMIN_EMAIL;
  }

  è§£å†³çš„ç—›ç‚¹:
  | ç—›ç‚¹            | è§£å†³æ–¹æ¡ˆ                     |
  |---------------|--------------------------|
  | ä¸ªäººé¡¹ç›®ä¸éœ€è¦å¤æ‚ç”¨æˆ·ç³»ç»Ÿ | ç›´æ¥ç”¨ GitHub OAuthï¼Œé›¶ç”¨æˆ·æ•°æ®åº“  |
  | æƒé™ç®¡ç†å¤æ‚        | ç™½åå•æœºåˆ¶ï¼Œé‚®ç®±åŒ¹é…å³å¯             |
  | å®‰å…¨æ€§           | OAuth ä¸å­˜å¯†ç ï¼ŒGitHub æ‰˜ç®¡è®¤è¯å®‰å…¨ |

  é¢è¯•è€ƒç‚¹:
  - OAuth 2.0 æµç¨‹: Authorization Code Grant (æœ€å®‰å…¨çš„ flow)
  - ä¸ºä»€ä¹ˆä¸ç”¨ JWT? å¯¹äºä¸ªäººé¡¹ç›®ï¼Œsession-based (NextAuth é»˜è®¤) æ›´ç®€å•ï¼Œæ— éœ€è‡ªå·±ç®¡ç† token åˆ·æ–°

  ---
  5. Conventional Commits + è‡ªåŠ¨ Release

  é…ç½®ä½ç½®: .github/workflows/release-notes.yml

  # PR åˆå¹¶æ—¶è‡ªåŠ¨:
  # 1. è§£æ commit ç±»å‹ (feat/fix/refactor...)
  # 2. è®¡ç®—ç‰ˆæœ¬å· (breakingâ†’major, featâ†’minor, fixâ†’patch)
  # 3. ç”Ÿæˆ Changelog å¹¶åˆ›å»º GitHub Release

  è§£å†³çš„ç—›ç‚¹:
  | ç—›ç‚¹            | è§£å†³æ–¹æ¡ˆ           |
  |---------------|----------------|
  | ç‰ˆæœ¬å·ç®¡ç†æ··ä¹±       | è¯­ä¹‰åŒ–ç‰ˆæœ¬è‡ªåŠ¨è®¡ç®—      |
  | Changelog æ‡’å¾—å†™ | ä» commit è‡ªåŠ¨ç”Ÿæˆ  |
  | å‘ç‰ˆæµç¨‹ç¹ç        | PR åˆå¹¶å³å‘ç‰ˆï¼Œé›¶æ‰‹åŠ¨æ“ä½œ |

  é¢è¯•è€ƒç‚¹:
  - Semantic Versioning: MAJOR.MINOR.PATCH çš„å«ä¹‰
  - Conventional Commits è§„èŒƒ: type(scope): description æ ¼å¼

  ---
  6. TypeScript ä¸¥æ ¼æ¨¡å¼ + å¢é‡ç¼–è¯‘

  é…ç½®ä½ç½®: tsconfig.json

  {
    "compilerOptions": {
      "strict": true,
      "incremental": true,
      "composite": true
    }
  }

  è§£å†³çš„ç—›ç‚¹:
  | ç—›ç‚¹              | è§£å†³æ–¹æ¡ˆ                                  |
  |-----------------|---------------------------------------|
  | è¿è¡Œæ—¶ç±»å‹é”™è¯¯         | strict: true åœ¨ç¼–è¯‘æœŸæ•è·                   |
  | ç±»å‹æ£€æŸ¥æ…¢           | incremental: true åªæ£€æŸ¥å˜æ›´æ–‡ä»¶             |
  | Monorepo ç±»å‹è·¨åŒ…å¼•ç”¨ | composite: true æ”¯æŒ project references |

  é¢è¯•è€ƒç‚¹:
  - strict åŒ…å«å“ªäº›? strictNullChecks, noImplicitAny, strictFunctionTypes ç­‰
  - å¢é‡ç¼–è¯‘åŸç†: é€šè¿‡ .tsbuildinfo æ–‡ä»¶ç¼“å­˜ç¼–è¯‘çŠ¶æ€

  ---
  7. Sentry é”™è¯¯ç›‘æ§ + æ™ºèƒ½è¿‡æ»¤

  é…ç½®ä½ç½®: apps/web/sentry.server.config.ts

  Sentry.init({
    tracesSampleRate: process.env.NODE_ENV === "production" ? 0.1 : 1.0,
    beforeSend(event) {
      // è¿‡æ»¤å¼€å‘ç¯å¢ƒ MongoDB è¿æ¥é”™è¯¯
      // è¿‡æ»¤ GitHub API é™æµé”™è¯¯
      return event;
    }
  });

  è§£å†³çš„ç—›ç‚¹:
  | ç—›ç‚¹       | è§£å†³æ–¹æ¡ˆ                    |
  |----------|-------------------------|
  | çº¿ä¸Šé”™è¯¯æ— æ³•è¿½è¸ª | Sentry è‡ªåŠ¨æ•è·å¹¶ä¸ŠæŠ¥          |
  | é”™è¯¯å™ªéŸ³å¤ªå¤š   | beforeSend è¿‡æ»¤æ— å…³é”™è¯¯       |
  | æ€§èƒ½é—®é¢˜éš¾å®šä½  | tracesSampleRate é‡‡æ ·æ€§èƒ½è¿½è¸ª |

  é¢è¯•è€ƒç‚¹:
  - ä¸ºä»€ä¹ˆ production åªé‡‡æ · 10%? èŠ‚çœé…é¢ï¼Œç»Ÿè®¡æ„ä¹‰è¶³å¤Ÿ
  - Source Map ä¸Šä¼ : ç”Ÿäº§ç¯å¢ƒä»£ç è¢«å‹ç¼©ï¼Œéœ€è¦ Source Map å®šä½åŸå§‹è¡Œå·

  ---
  ä¸‰ã€å¯è¡¥å……çš„å·¥ç¨‹åŒ–æ–¹å‘

  åŸºäºä½ çš„é¡¹ç›®ï¼Œä»¥ä¸‹æ˜¯æˆ‘å‘ç°çš„å·²æœ‰ä½†æœªæåŠä»¥åŠå¯è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç‚¹:

  å·²æœ‰äº®ç‚¹ (æœªæåŠ):

  | ç‰¹æ€§                 | ä½ç½®                     | ä½œç”¨                        |
  |--------------------|------------------------|---------------------------|
  | Ant Design CSS é¢„ç”Ÿæˆ | scripts/genAntdCss.tsx | é¿å…è¿è¡Œæ—¶ CSS-in-JS å¼€é”€ï¼Œæå‡ FCP |
  | ç¯å¢ƒå˜é‡æ„å»ºæ—¶æ ¡éªŒ          | next.config.mjs        | ç¼ºå¤±å…³é”®å˜é‡æ—¶æ„å»ºç›´æ¥å¤±è´¥ï¼Œé¿å…è¿è¡Œæ—¶æŠ¥é”™     |
  | æµ‹è¯•åŒå±‚æ¶æ„             | Jest + Playwright      | å•å…ƒæµ‹è¯• + E2E è¦†ç›–ä¸åŒå±‚çº§         |
  | Tailwind è‡ªå®šä¹‰è®¾è®¡ç³»ç»Ÿ   | tailwind.config.ts     | ç»Ÿä¸€é¢œè‰²/å­—ä½“ï¼Œé¿å…é­”æ³•å€¼             |

  å¯è¿›ä¸€æ­¥ä¼˜åŒ–:

  | æ–¹å‘              | å»ºè®®                                           |
  |-----------------|----------------------------------------------|
  | Bundle åˆ†æ       | å®šæœŸè¿è¡Œ ANALYZE=true yarn build æ£€æŸ¥åŒ…ä½“ç§¯           |
  | Lighthouse CI   | GitHub Actions ä¸­é›†æˆè‡ªåŠ¨åŒ–æ€§èƒ½æµ‹è¯•                    |
  | ä¾èµ–æ›´æ–°è‡ªåŠ¨åŒ–         | è€ƒè™‘ Renovate Bot è‡ªåŠ¨åˆ›å»ºä¾èµ–æ›´æ–° PR                  |
  | Git worktree ç®¡ç† | ä½ å·²æœ‰ sync-env-to-worktree.shï¼Œå¯ä»¥æ–‡æ¡£åŒ–è¿™ä¸ªå¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æµç¨‹ |

  ---
  å››ã€é¢è¯•è¯æœ¯ç¤ºä¾‹

  é¢è¯•å®˜: è¯´è¯´ä½ åœ¨å·¥ç¨‹åŒ–æ–¹é¢åšè¿‡ä»€ä¹ˆ?

  å›ç­”æ¨¡æ¿:

  "æˆ‘è´Ÿè´£äº†ä¸€ä¸ª Monorepo é¡¹ç›®çš„å·¥ç¨‹åŒ–æ­å»ºã€‚ä¸»è¦åšäº†å‡ ä»¶äº‹:

  1. æ„å»ºä¼˜åŒ–: ç”¨ Turborepo ç®¡ç† 4 ä¸ªåŒ…ï¼Œåˆ©ç”¨å¢é‡æ„å»ºå’Œç¼“å­˜ï¼ŒCI æ—¶é—´ä» 5 åˆ†é’Ÿé™åˆ° 30 ç§’
  2. ä»£ç è´¨é‡: Husky + lint-staged åœ¨æäº¤æ—¶è‡ªåŠ¨æ ¼å¼åŒ–å’Œç±»å‹æ£€æŸ¥ï¼Œé…åˆ commitlint è§„èŒƒæäº¤ä¿¡æ¯
  3. è‡ªåŠ¨åŒ–å‘ç‰ˆ: GitHub Actions è§£æ Conventional Commits è‡ªåŠ¨ç”Ÿæˆ Changelog å’Œè¯­ä¹‰åŒ–ç‰ˆæœ¬å·
  4. æ€§èƒ½ä¼˜åŒ–: å›¾ç‰‡è‡ªåŠ¨è½¬ AVIF/WebPï¼Œé…åˆ immutable ç¼“å­˜ç­–ç•¥ï¼ŒLCP æå‡ 40%
  5. ç›‘æ§ä½“ç³»: Sentry é›†æˆé”™è¯¯è¿½è¸ªï¼Œå¹¶é€šè¿‡ beforeSend è¿‡æ»¤å¼€å‘å™ªéŸ³"

  ---
   ä¸€ã€Sentry é”™è¯¯ç›‘æ§ç³»ç»Ÿ

     1.1 ä¸‰å±‚é…ç½®æ¶æ„

     ä½ çš„é¡¹ç›®é‡‡ç”¨äº†åˆ†è¿è¡Œæ—¶é…ç½®çš„ç­–ç•¥ï¼Œé’ˆå¯¹ä¸åŒç¯å¢ƒæœ‰ä¸åŒçš„ Sentry é…ç½®:

     | é…ç½®æ–‡ä»¶                    | è¿è¡Œç¯å¢ƒ         | ç‰¹æ®Šå¤„ç†                             |
     |-------------------------|--------------|----------------------------------|
     | sentry.client.config.ts | æµè§ˆå™¨          | Session Replayã€ChunkLoadError è¿‡æ»¤ |
     | sentry.server.config.ts | Node.js æœåŠ¡ç«¯  | MongoDB/GitHub API é”™è¯¯è¿‡æ»¤          |
     | sentry.edge.config.ts   | Edge Runtime | Edge é™åˆ¶é”™è¯¯è¿‡æ»¤                      |

     1.2 beforeSend è¿‡æ»¤æœºåˆ¶è¯¦è§£

     é¢è¯•è¯æœ¯: "æˆ‘ä»¬é€šè¿‡ beforeSend é’©å­åœ¨é”™è¯¯ä¸ŠæŠ¥å‰è¿›è¡Œè¿‡æ»¤ï¼Œé¿å…æ— æ„ä¹‰çš„é”™è¯¯å™ªéŸ³å ç”¨ Sentry é…é¢"

     å®¢æˆ·ç«¯è¿‡æ»¤ (sentry.client.config.ts)

     beforeSend(event) {
       // å¼€å‘ç¯å¢ƒæ‰“å°åˆ°æ§åˆ¶å°ï¼Œæ–¹ä¾¿è°ƒè¯•
       if (process.env.NODE_ENV === "development") {
         console.group("ğŸš¨ Sentry Error");
         console.error(event);
         console.groupEnd();
       }

       // è¿‡æ»¤ ChunkLoadError - ç”¨æˆ·ç½‘ç»œé—®é¢˜å¯¼è‡´çš„åŠ¨æ€åŠ è½½å¤±è´¥
       if (event.exception) {
         const error = event.exception.values?.[0];
         if (error?.type === "ChunkLoadError" ||
             error?.value?.includes("Loading chunk")) {
           return null;  // è¿”å› null = ä¸ä¸ŠæŠ¥
         }
       }
       return event;
     }

     ä¸ºä»€ä¹ˆè¿‡æ»¤ ChunkLoadError?
     - è¿™æ˜¯ç”¨æˆ·ç½‘ç»œé—®é¢˜ï¼Œä¸æ˜¯ä»£ç  bug
     - å¤§é‡ä¸ŠæŠ¥ä¼šå¿«é€Ÿæ¶ˆè€— Sentry é…é¢
     - è§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯åœ¨ UI å±‚åšé‡è¯•é€»è¾‘ï¼Œè€Œä¸æ˜¯ç›‘æ§

     æœåŠ¡ç«¯è¿‡æ»¤ (sentry.server.config.ts)

     beforeSend(event) {
       if (event.exception) {
         const error = event.exception.values?.[0];

         // å¼€å‘ç¯å¢ƒè¿‡æ»¤ MongoDB è¿æ¥è¶…æ—¶
         if (process.env.NODE_ENV === "development" &&
             error?.value?.includes("MongooseServerSelectionError")) {
           return null;
         }

         // è¿‡æ»¤ GitHub API é€Ÿç‡é™åˆ¶
         if (error?.value?.includes("API rate limit exceeded")) {
           return null;
         }
       }
       return event;
     }

     ä¸ºä»€ä¹ˆè¿‡æ»¤è¿™äº›?
     - MongoDB è¿æ¥é”™è¯¯ (å¼€å‘ç¯å¢ƒ): æœ¬åœ°å¼€å‘æ—¶æ•°æ®åº“ç»å¸¸ç¦»çº¿ï¼Œä¸éœ€è¦ä¸ŠæŠ¥
     - GitHub API é™æµ: è¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼Œä»£ç ä¸­åº”è¯¥å·²ç»ä¼˜é›…å¤„ç†äº†

     1.3 é‡‡æ ·ç‡ç­–ç•¥

     {
       // æ€§èƒ½äº‹åŠ¡é‡‡æ ·
       tracesSampleRate: process.env.NODE_ENV === "production" ? 0.1 : 1.0,

       // æ€§èƒ½åˆ†æé‡‡æ · (æ›´è´µ)
       profilesSampleRate: process.env.NODE_ENV === "production" ? 0.05 : 1.0,

       // ä¼šè¯å›æ”¾é‡‡æ ·
       replaysSessionSampleRate: process.env.NODE_ENV === "production" ? 0.1 : 1.0,
       replaysOnErrorSampleRate: 1.0,  // é”™è¯¯æ—¶ 100% è®°å½•
     }

     é¢è¯•è¯æœ¯: "æˆ‘ä»¬ç”¨å·®å¼‚åŒ–é‡‡æ ·ç‡å¹³è¡¡æˆæœ¬å’Œå¯è§‚æµ‹æ€§:
     - ç”Ÿäº§ç¯å¢ƒåªé‡‡æ · 10% çš„æ­£å¸¸äº‹åŠ¡
     - ä½† 100% è®°å½•é”™è¯¯æ—¶çš„ä¼šè¯å›æ”¾ï¼Œç¡®ä¿æ¯ä¸ª bug éƒ½èƒ½å¤ç°
     - å¼€å‘ç¯å¢ƒå…¨é‡‡æ ·ï¼Œä¾¿äºè°ƒè¯•"

     1.4 ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ (logger.ts)

     ä½ é¡¹ç›®ä¸­å°è£…äº†ä¸€ä¸ª Logger ç±»ï¼Œè‡ªåŠ¨å°†æ—¥å¿—å‘é€åˆ° Sentry:

     // ä½¿ç”¨æ–¹å¼
     import { logger } from "@/monitoring/logger";

     logger.error("Database connection failed", error, { userId: "123" });
     logger.apiCall("/api/endpoint", "GET", 200, 45);  // è‡ªåŠ¨è®°å½• API è°ƒç”¨
     logger.performance("render_list", 123);           // æ€§èƒ½ç›‘æ§

     ---
     äºŒã€Cloudinary å›¾ç‰‡å­˜å‚¨ + CDN ç­–ç•¥

     2.1 ä¸ºä»€ä¹ˆé€‰æ‹© Cloudinary?

     | å¯¹æ¯”é¡¹    | è‡ªå»ºå­˜å‚¨     | Cloudinary |
     |--------|----------|------------|
     | CDN åŠ é€Ÿ | éœ€è¦é¢å¤–é…ç½®   | è‡ªå¸¦å…¨çƒ CDN   |
     | å›¾ç‰‡è½¬æ¢   | éœ€è¦æœåŠ¡ç«¯å¤„ç†  | URL å‚æ•°å³å¯è½¬æ¢ |
     | æˆæœ¬     | æœåŠ¡å™¨ + å¸¦å®½ | å…è´¹é¢åº¦è¶³å¤Ÿä¸ªäººé¡¹ç›® |
     | ç»´æŠ¤     | éœ€è¦è¿ç»´     | æ‰˜ç®¡æœåŠ¡ï¼Œé›¶è¿ç»´   |

     2.2 å­˜å‚¨æ¶æ„

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ ç”¨æˆ·ä¸Šä¼  flomo ZIP / GitHub å›¾ç‰‡                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ WhisperParser è§£æå›¾ç‰‡                               â”‚
     â”‚ - Base64 ç¼–ç å›¾ç‰‡ (data:image/...)                  â”‚
     â”‚ - å¤–éƒ¨ URL (http://...)                             â”‚
     â”‚ - æœ¬åœ°æ–‡ä»¶è·¯å¾„                                       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Cloudinary ä¸Šä¼                                       â”‚
     â”‚ - æ–‡ä»¶å¤¹: whisper-images                            â”‚
     â”‚ - å…¬å¼€ ID: {entryId}_{index}_{timestamp}            â”‚
     â”‚ - è‡ªåŠ¨ç”Ÿæˆ secure_url                               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ å­˜å‚¨åˆ° MongoDB + å‰ç«¯å±•ç¤º                            â”‚
     â”‚ https://res.cloudinary.com/xxx/image/upload/...      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     2.3 CDN ç¼“å­˜ç­–ç•¥

     Next.js é…ç½® (next.config.mjs):

     async headers() {
       return [
         {
           // æ‰€æœ‰å›¾ç‰‡èµ„æº
           source: "/(.*)\\.(avif|webp|jpg|jpeg|png|ico|svg)$",
           headers: [
             {
               key: "Cache-Control",
               // 1å¹´ç¼“å­˜ + immutable (æµè§ˆå™¨ä¸ä¼šé‡æ–°éªŒè¯)
               value: "public, max-age=31536000, immutable",
             },
             {
               key: "Vary",
               value: "Accept",  // æ ¹æ® Accept header è¿”å›ä¸åŒæ ¼å¼
             },
           ],
         },
       ];
     }

     é¢è¯•è¯æœ¯: "æˆ‘ä»¬çš„å›¾ç‰‡ç¼“å­˜ç­–ç•¥æ˜¯:
     1. Cloudinary CDN: å›¾ç‰‡å­˜å‚¨åœ¨ Cloudinaryï¼Œè‡ªå¸¦å…¨çƒ CDN åŠ é€Ÿ
     2. immutable ç¼“å­˜: è®¾ç½® 1 å¹´ç¼“å­˜ä¸” immutableï¼Œæµè§ˆå™¨ä¸ä¼šé‡å¤è¯·æ±‚
     3. Vary: Accept: é…åˆ Next.js çš„ <Image> ç»„ä»¶ï¼Œæ ¹æ®æµè§ˆå™¨æ”¯æŒè¿”å› AVIF/WebP/åŸå›¾"

     2.4 å›¾ç‰‡æ ¼å¼ä¼˜åŒ–

     // next.config.mjs
     images: {
       formats: ["image/avif", "image/webp"],  // AVIF ä¼˜å…ˆ
       remotePatterns: [
         { protocol: "https", hostname: "res.cloudinary.com", pathname: "/**" },
         { protocol: "https", hostname: "avatars.githubusercontent.com" },
       ]
     }

     æ ¼å¼å¯¹æ¯”:
     | æ ¼å¼   | å‹ç¼©ç‡          | å…¼å®¹æ€§                     | é€‚ç”¨åœºæ™¯    |
     |------|--------------|-------------------------|---------|
     | AVIF | æ¯” JPEG å° 50% | Chrome 85+, Firefox 93+ | ç°ä»£æµè§ˆå™¨é¦–é€‰ |
     | WebP | æ¯” JPEG å° 30% | 95%+ æµè§ˆå™¨æ”¯æŒ              | å¤‡é€‰æ ¼å¼    |
     | JPEG | åŸºå‡†           | 100%                    | å…œåº•æ ¼å¼    |

     2.5 æ‰¹é‡åˆ é™¤ä¼˜åŒ–

     // æ™ºèƒ½è¿‡æ»¤: åªåˆ é™¤ Cloudinary å›¾ç‰‡
     export async function deleteImagesByUrls(urls: string[]) {
       // è¿‡æ»¤é Cloudinary URL
       const cloudinaryUrls = urls.filter(url =>
         url.includes("res.cloudinary.com")
       );

       // æ‰¹é‡åˆ é™¤ (æ¯æ‰¹æœ€å¤š 100 å¼ )
       for (let i = 0; i < publicIds.length; i += 100) {
         const batch = publicIds.slice(i, i + 100);
         await cloudinary.api.delete_resources(batch);
       }
     }

     ---
     ä¸‰ã€Release Notes è‡ªåŠ¨åŒ–æµç¨‹

     3.1 æ•´ä½“å·¥ä½œæµ

     PR åˆå¹¶åˆ° main
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ GitHub Actions è§¦å‘           â”‚
     â”‚ (release-notes.yml)           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ 1. è·å–æœ€æ–° tag (git describe)â”‚
     â”‚    ä¾‹: v0.0.0                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ 2. è¯»å– PR ä¸­æ‰€æœ‰ commits     â”‚
     â”‚    github.rest.pulls.listCommitsâ”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ 3. è§£æ Conventional Commits  â”‚
     â”‚    æ­£åˆ™: /^(\w+)(?:\(([^)]+)\))?(!)?:\s*(.+)$/â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ 4. å†³å®šç‰ˆæœ¬å¢é•¿ç±»å‹           â”‚
     â”‚    Breaking(!) â†’ Major        â”‚
     â”‚    feat â†’ Minor               â”‚
     â”‚    å…¶ä»– â†’ Patch               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ 5. ç”Ÿæˆ Changelog             â”‚
     â”‚    æŒ‰ç±»åˆ«åˆ†ç»„ + emoji         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ 6. åˆ›å»º GitHub Release        â”‚
     â”‚    gh release create          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     3.2 Conventional Commits è§£æ

     æ­£åˆ™è¡¨è¾¾å¼:
     /^(\w+)(?:\(([^)]+)\))?(!)?:\s*(.+)$/

     è§£æç¤ºä¾‹:
     | æäº¤ä¿¡æ¯                    | type     | scope    | breaking | description |
     |-------------------------|----------|----------|----------|-------------|
     | feat(releases): æ·»åŠ é¡µé¢    | feat     | releases | false    | æ·»åŠ é¡µé¢        |
     | fix!: ç´§æ€¥ä¿®å¤              | fix      | null     | true     | ç´§æ€¥ä¿®å¤        |
     | refactor(service): é‡æ„ä»£ç  | refactor | service  | false    | é‡æ„ä»£ç         |

     3.3 è¯­ä¹‰åŒ–ç‰ˆæœ¬è®¡ç®—

     // ç‰ˆæœ¬å¢é•¿å†³ç­–
     let bumpType = 'patch';
     if (hasBreaking) bumpType = 'major';  // æœ‰ ! æ ‡è®°
     else if (hasFeat) bumpType = 'minor';  // æœ‰æ–°åŠŸèƒ½
     // å¦åˆ™æ˜¯ patch

     // ç‰ˆæœ¬å·è®¡ç®—
     // v1.2.3 + major â†’ v2.0.0
     // v1.2.3 + minor â†’ v1.3.0
     // v1.2.3 + patch â†’ v1.2.4

     3.4 Changelog ç”Ÿæˆæ ¼å¼

     ## ğŸ’¥ Breaking Changes
     - **service:** API æ¶æ„å˜æ›´ (`f7a3b1c`)

     ## âœ¨ Features
     - **releases:** æ·»åŠ å…¬å¼€çš„ Release Notes é¡µé¢ (`c739025`)

     ## ğŸ› Bug Fixes
     - **service:** ä¿®å¤éƒ¨ç½²é…ç½® (`d1b45ea`)

     ## â™»ï¸ Refactoring
     - æ¸…ç†æ—§ä»£ç  (`40f347b`)

     ---

     ğŸ“‹ [PR #36](https://github.com/gwifloria/wonderland-nexus/pull/36)

     3.5 æ ¸å¿ƒé…ç½®è§£è¯»

     # .github/workflows/release-notes.yml

     on:
       pull_request:
         types: [closed]      # PR å…³é—­æ—¶è§¦å‘
         branches: [main]     # ä»… main åˆ†æ”¯

     jobs:
       generate-release-notes:
         if: github.event.pull_request.merged == true  # ç¡®ä¿æ˜¯åˆå¹¶ï¼Œä¸æ˜¯æ‹’ç»

         permissions:
           contents: write    # éœ€è¦å†™æƒé™åˆ›å»º Release

         steps:
           - uses: actions/checkout@v4
             with:
               fetch-depth: 0  # è·å–å®Œæ•´å†å²ä»¥è¯»å– tags

     ---
     å››ã€é¢è¯•å…«è‚¡æ–‡å¯¹ç…§

     4.1 Sentry ç›¸å…³

     Q: å‰ç«¯é”™è¯¯ç›‘æ§æ€ä¹ˆåšçš„?

     A: "æˆ‘ä»¬ç”¨ Sentry åšé”™è¯¯ç›‘æ§ï¼Œæœ‰å‡ ä¸ªå…³é”®é…ç½®:
     1. åˆ†ç¯å¢ƒé…ç½®: å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ã€Edge å„æœ‰ç‹¬ç«‹é…ç½®
     2. beforeSend è¿‡æ»¤: è¿‡æ»¤ ChunkLoadErrorã€MongoDB å¼€å‘é”™è¯¯ç­‰å™ªéŸ³
     3. å·®å¼‚åŒ–é‡‡æ ·: ç”Ÿäº§ç¯å¢ƒ 10% é‡‡æ ·æ§åˆ¶æˆæœ¬ï¼Œé”™è¯¯æ—¶ 100% è®°å½• Session Replay ç¡®ä¿å¯å¤ç°
     4. ç»Ÿä¸€ Logger: å°è£…æ—¥å¿—ç±»è‡ªåŠ¨ä¸ŠæŠ¥åˆ° Sentry"

     4.2 CDN ç›¸å…³

     Q: å›¾ç‰‡ä¼˜åŒ–å’Œ CDN æ€ä¹ˆé…ç½®çš„?

     A: "æˆ‘ä»¬çš„å›¾ç‰‡å­˜å‚¨åœ¨ Cloudinary:
     1. æ ¼å¼ä¼˜åŒ–: Next.js Image ç»„ä»¶é…åˆ formats: ['avif', 'webp']ï¼Œè‡ªåŠ¨è¿”å›æœ€ä¼˜æ ¼å¼
     2. CDN åŠ é€Ÿ: Cloudinary è‡ªå¸¦å…¨çƒ CDN
     3. ç¼“å­˜ç­–ç•¥: Cache-Control: public, max-age=31536000, immutableï¼Œ1 å¹´ä¸è¿‡æœŸ
     4. Vary: Accept: æ ¹æ®æµè§ˆå™¨æ”¯æŒè¿”å›ä¸åŒæ ¼å¼"

     Q: immutable å’Œ max-age æœ‰ä»€ä¹ˆåŒºåˆ«?

     A: "max-age åªæ˜¯å‘Šè¯‰æµè§ˆå™¨ç¼“å­˜å¤šä¹…ï¼Œä½†æµè§ˆå™¨åˆ·æ–°æ—¶ä»å¯èƒ½å‘éªŒè¯è¯·æ±‚ã€‚immutable å‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªèµ„æºæ°¸è¿œä¸ä¼šå˜ï¼Œå³ä½¿å¼ºåˆ·ä¹Ÿä¸éœ€è¦é‡æ–°éªŒè¯ã€‚é€‚åˆå¸¦ hash çš„é™æ€èµ„æºã€‚"

     4.3 CI/CD ç›¸å…³

     Q: ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæµç¨‹æ˜¯æ€æ ·çš„?

     A: "æˆ‘ä»¬ç”¨ GitHub Actions è‡ªåŠ¨åŒ–:
     1. Conventional Commits: æäº¤ä¿¡æ¯éµå¾ª type(scope): description æ ¼å¼
     2. è‡ªåŠ¨ç‰ˆæœ¬è®¡ç®—: Breaking â†’ Major, feat â†’ Minor, fix â†’ Patch
     3. è‡ªåŠ¨ Changelog: æŒ‰ç±»å‹åˆ†ç»„ï¼Œå¸¦ emoji å’Œ commit hash
     4. è‡ªåŠ¨ Release: PR åˆå¹¶å³å‘ç‰ˆï¼Œé›¶æ‰‹åŠ¨æ“ä½œ"

     ---
     äº”ã€è¡¥å……: å…¶ä»–å¯æåŠçš„å·¥ç¨‹åŒ–äº®ç‚¹

     åŸºäºæ¢ç´¢å‘ç°çš„å…¶ä»–äº®ç‚¹:

     | ç‰¹æ€§                     | ä½ç½®                      | é¢è¯•åŠ åˆ†ç‚¹                             |
     |------------------------|-------------------------|-----------------------------------|
     | ErrorBoundary + Sentry | ErrorBoundary.tsx       | React é”™è¯¯è¾¹ç•Œä¸ Sentry é›†æˆï¼Œæ”¯æŒç”¨æˆ·åé¦ˆ      |
     | æ€§èƒ½ç›‘æ§                   | performance.ts          | Web Vitals é‡‡é›† + Sentry Breadcrumb |
     | HTTP è¯·æ±‚è¿‡æ»¤              | sentry.server.config.ts | å¿½ç•¥å¥åº·æ£€æŸ¥å’Œé™æ€èµ„æºçš„æ€§èƒ½è¿½è¸ª                  |
     | ç¯å¢ƒå˜é‡æ„å»ºæ—¶æ ¡éªŒ              | next.config.mjs         | ç¼ºå¤±å…³é”®å˜é‡æ—¶æ„å»ºå¤±è´¥ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯               |

âº è¯¦ç»†æ€»ç»“å·²å®Œæˆï¼Œä¿å­˜åœ¨ /Users/guihuajiu/.claude/plans/scalable-spinning-narwhal.mdã€‚

  ä¸»è¦å†…å®¹åŒ…æ‹¬:

  Sentry é”™è¯¯ç›‘æ§

  - ä¸‰å±‚é…ç½®æ¶æ„ (client/server/edge)
  - beforeSend è¿‡æ»¤: ChunkLoadErrorã€MongoDB å¼€å‘é”™è¯¯ã€GitHub API é™æµ
  - å·®å¼‚åŒ–é‡‡æ ·ç‡: ç”Ÿäº§ 10%ï¼Œé”™è¯¯å›æ”¾ 100%

  Cloudinary + CDN

  - å­˜å‚¨æ¶æ„: flomo/GitHub å›¾ç‰‡ â†’ Cloudinary â†’ MongoDB
  - ç¼“å­˜ç­–ç•¥: immutable + 1 å¹´ max-age
  - æ ¼å¼ä¼˜åŒ–: AVIF > WebP > JPEG è‡ªåŠ¨åå•†

  Release Notes è‡ªåŠ¨åŒ–

  - è§¦å‘æ¡ä»¶: PR åˆå¹¶åˆ° main
  - Conventional Commits è§£ææ­£åˆ™
  - è¯­ä¹‰åŒ–ç‰ˆæœ¬è‡ªåŠ¨è®¡ç®— (breakingâ†’major, featâ†’minor, fixâ†’patch)
  - Changelog æŒ‰ç±»å‹åˆ†ç»„ + emoji

  æ¯ä¸ªæ¨¡å—éƒ½é…æœ‰é¢è¯•è¯æœ¯ï¼Œå¯ä»¥ç›´æ¥ç”¨äºé¢è¯•å›ç­”ã€‚éœ€è¦æˆ‘æŠŠè¿™ä»½æ–‡æ¡£å¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹ä¿å­˜å—?
